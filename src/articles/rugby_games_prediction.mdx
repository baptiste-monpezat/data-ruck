---
title: "Mes pronostics rugby avec du Machine Learning"
slug: "pronostics-rugby-machine-learning"
datePublished: "2024-12-10"
author: "Baptiste Monpezat"
categories: "Machine Learning | Data Science | Pronostics | Rugby | TOP 14 | PRO D2"
---


# Devenir un(e) maestro des pronos 

Emport√© par la ferveur du supporter, il m'arrive souvent de donner mon √©quipe favorite gagnante. Et mon pronostic 
s'av√®re la plupart du temps faux... Alors je me suis pos√© les questions suivantes: Est-il possible d'avoir un pronostic
plus objectif ? Quelle est la probabilit√© que mon √©quipe favorite gagne ? Et quels sont les facteurs qui font qu'une √©quipe 
est donn√©e gagnante ?

Si tu as lu mon article pr√©c√©dent, tu sais que jouer √† domicile en TOP 14 ou en PRO D2 donne un avantage non n√©gligeable. Si tu ne l'as pas encore lu, c'est par
[ici](https://www.data-ruck.com/blog/rugby-home-advantages/) üëà

Dans cet article, je vais pr√©senter ma m√©thodologie pour cr√©er un mod√®le de machine learning et √©valuer sa performance pour pr√©dire les r√©sultats des matchs !\
Pour cela nous allons aborder les sujets suivants:
1. Les datas √† disposition pour entra√Æner le mod√®le
2. Cr√©er un mod√®le de r√©f√©rence √† battre
3. Cr√©er de nouvelles variables 
4. S√©lectionner les variables les plus pertinentes
5. Les limites de l'analyse

Alors si tu en as marre de faire des pronos au doigt mouill√©, cet article est pour toi ! 

# 1. Les datas √† disposition pour entra√Æner le mod√®le

Pour prendre une d√©cision, il nous faut des informations ! Et oui, les datas c'est le nerf de la guerre, plus on 
a de datas, plus on a d'informations et plus on sera capable de mod√®liser un ph√©nom√®ne gr√¢ce √† ces informations. 

Ici le ph√©nom√®ne que l'on doit mod√©liser, c'est le r√©sultat d'un match de rugby entre deux √©quipes. Pour cela nous disposons de l'historique des r√©sultats, classements et statistiques de matchs de PRO D2 ET TOP 14.\
Voici la r√©partition de r√©sultats des matchs des √©quipes √† domicile:
- 73% de victoires
- 23% de d√©faites
- 4% de matchs nuls

Le nombre de matchs ex-aeqo √©tant faible et donc difficile √† pr√©dire, nous allons nous concentrer 
sur les matchs avec une victoire ou une d√©faite. En enlevant les matchs nuls, le pourcentage de victoires √† domicile 
est de **75%**.


# 2. Un mod√®le de r√©f√©rence

Pour cr√©er et √©valuer un mod√®le, nous devons d'abord d√©finir une mesure de performance du mod√®le ainsi qu'une mesure 
de r√©f√©rence. En effet, comment savoir si notre mod√®le est bon si nous n'avons pas d'√©l√®ment de comparaison ?\
Notre mesure de performance sera l'accuracy: le % de pr√©diction correct du mod√®le (la ratio de victoires/d√©faites correctement
pr√©dites sur le total de matchs). 

**1er mod√®le de r√©f√©rence: un mod√®le pas tr√®s objectif...**

Et si notre mod√®le de r√©f√©rence pr√©disait la victoire syst√®matique de l'√©quipe √† domicile, quel serait son accuracy ? 

Si vous avez suivi, l'accuracy de ce mod√®le est de ... **75%**. En effet, on a vu plus haut que les √©quipes √† 
domicile gagnent 75% de leur matchs ! 
Cela signifie que le mod√®le que l'on va cr√©er devra avoir une accuracy de plus de 75%.
Ce mod√®le n'est pas tr√®s performant car il est par construction incapable de pr√©dire une d√©faite
de l'√©quipe √† domicile.

**2eme mod√®le de r√©f√©rence: un mod√®le un peu plus intelligent**

Essayons d'√™tre un peu plus malin.... Nous pourrions utiliser la diff√©rence de points au classement du championnant √† la date 
du match pour pr√©dire le r√©sultat. L'hypoth√©se est qu'une √©quipe qui a plus de points au classement a plus de chance de gagner 
contre une √©quipe qui est moins bien class√©e. Regardons ce que √ßa donne: 

![Optimum distance](../images/rugby_games_prediction/baseline_model.jpg)
<div class="center-em">
*Diff√©rence de score en fonction de la diff√©rence de points au classement avant le match*
</div>

Notre hypoth√©se est bonne, plus la diff√©rence de points au classement est grande, plus la diff√©rence de score est grande ! 
On peut mod√©liser la relation entre ces deux variables avec une r√©gression lin√©aire (droite rouge sur le graphique ci-dessus) et 
on obtient ansi la formule suivante: 

$$ 
\begin{aligned}
Diff√©rence_{Score} = Diff√©rence_{Points}\times0.4 + 9.4
\end{aligned}
$$

***Petit exemple***: Le Stade Toulousain (76 points avant le match) re√ßoit la Rochelle (66 points avant le match), notre r√©gression 
lin√©aire pr√©dit une victoire du stade toulousain de 13 points: 

$$ 
\begin{aligned}
13.4 = 10\times0.4 + 9.4
\end{aligned}
$$

***Fun fact***: on remarque qu'avec un nombre de points au classement √©gal entre les deux √©quipes, l'√©quipe qui re√ßoit a un avantage de 9.4 points 
d'avance sur l'√©quipe adverse.\
On peut utiliser ce mod√®le pour pr√©dire le r√©sultat d'un match:
- Si la diff√©rence de score est > 0, l'√©quipe √† domicile gagne. 
- Si la diff√©rence de score est < 0, l'√©quipe √† domicile perd. 

Avec ce mod√®le, on obtient une accuracy l√©g√®rement sup√©rieure au mod√®le pr√©c√©dent: **76%**.\
Ce mod√®le est facilement am√©liorable: il n'est pas bon pour pr√©dire les premiers matchs de championnats car les diff√©rences de points au classement ne refl√©tent 
pas le niveau des √©quipes. 


# 3. Cr√©er de nouvelles variables 

L'objectif de cette partie est de trouver et construire de nouvelles variables qui seront utiles pour le mod√®le 
afin de pr√©dire le r√©sultat d'un match. Avez-vous des id√©es ? 

Voici les variables qui me viennent en t√™te et qui je pense peuvent aider le mod√®le √† prendre les bonnes d√©cisions:
- Taux de victoires sur diff√©rentes p√©riodes: 1, 3, 6... derniers matchs
- Taux de victoires √† domicile et √† l'ext√©rieur
- Taux de victoires contre l'√©quipe adverse 
- Nombre de points moyens marqu√©s/encaiss√©s contre l'√©quipe adverse 
- Score ELO 

Une technique que je vais √©galement utiliser consiste √† encoder les variables cat√©gorielles (par exemple le nom des √©quipes) √†
partir du r√©sultat des matchs, concr√©tement on peut remplacer le nom des √©quipes par la moyenne de matchs gagn√©s. 

## Score ELO

Comme dit pr√©c√©demment, le classement ne permet pas d'avoir une bonne indication du niveau 
des √©quipes, notamment durant les premi√®res journ√©es de championat. Nous allons donc calculer un **score ELO**.
Le score ELO a √©t√© invent√© par le physicien Arpad Elo pour √©valuer le niveau des joueurs d'√©checs mais il est maintenant 
utilis√© dans diff√©rents sports comme le football ou le esport pour quantifier le niveau d'une √©quipe. Le score ELO est un score relatif dont la logique est assez simple:
- Plus une √©quipe est performante, plus son score ELO est √©lev√©. 
- Si une √©quipe avec un score ELO bien plus √©lev√© que l'√©quipe adverse gagne le match, elle recevra peu de points 
et l'√©quipe adverse plus faible perdra peu de points.
- Au contraire, si une √©quipe avec un score ELO bien plus √©lev√© que l'√©quipe adverse perd le match, elle sera p√©nalis√©e 
d'un grand nombre de points et l'√©quipe plus faible sera r√©compens√©e proportionellement. 

Pour les plus t√©m√©raires, j'ai mis la formule en annexe √† la fin de l'article.
Voila le r√©sultat sur la saison 2023-2024: 

![Elo Score](../images/rugby_games_prediction/elo_score_2023.jpg)
<div class="center-em">
*Evolution du score Elo en TOP 14 saison 2023-2024*
</div>

## Taux de victoire

Le taux de victoire est √©galement une variable qui me semble importante √† calculer. 
Une de mes hypoth√©ses est que la ratio entre le taux de victoire (sur les x matchs pr√©c√©dents) de l'√©quipe √† domicile et 
le taux de victoire de l'√©quipe √† l'ext√©rieure est corr√©l√©e avec la diff√©rence de score. 

Bingo ! Mon hypoth√®se est valide, il y a bien une corr√©lation (coefficient de pearson de 0.33) entre ce ratio et la 
diff√©rence de score: 

![Diff√©rence de score VS Ratio taux de victoire des deux √©quipes](../images/rugby_games_prediction/win_rate_ratio.jpg)
<div class="center-em">
*Diff√©rence de score VS Ratio taux de victoire 
des deux √©quipes sur les matchs pr√©c√©dents*
</div>

Mais combien de matchs pr√©c√©dents doit on prendre en compte dans le calcul pour avoir un 
taux de victoire repr√©sentatif ? 2 matchs, 4 matchs, x matchs.
Pour y r√©pondre, j'ai calcul√© la corr√©lation entre la diff√©rence de score et le taux de victoire avec diff√©rentes 
fen√™tres de calculs et voici le r√©sultat: 

![Corr√©lation entre diff√©rence de score et taux de victoire de l'√©quipe ext√©rieure
pour diff√©rente fen√™tre de calcul](../images/rugby_games_prediction/correlation_victoire_exterieure.jpg)
<div class="center-em">
*Corr√©lation entre diff√©rence de score et taux de victoire de l'√©quipe ext√©rieure
pour diff√©rentes fen√™tres de calculs*
</div>

Le coude de la courbe se situe aux alentours d'une dizaine de match avec une corr√©lation avoisinant 
les -0.25 (plus l'√©quipe √† l'ext√©rieure √† un taux de victoire important, plus la diff√©rence de score domicile 
vs ext√©rieure sera faible)

# 4. S√©lectionner les variables les plus pertinentes

Une fois que nous avons cr√©√© ces nouvelles variables, il est temps de s√©lectionner celles qui sont 
les plus importantes. Pour faire cela, l'id√©e est d'entrainer un mod√®le 
√† pr√©dire le r√©sultat des matchs et regarder les variables qui apportent le plus d'informations.

Je ne vais pas entrer dans le d√©tail mais si cela vous int√©resse: j'ai utilis√© un mod√®le random forest 
car il fournit des informations sur l'importance des variables apr√®s l'entrainement. 

Voici le classement des variables en fonction de leur importance: 
![Importance des variables](../images/rugby_games_prediction/ranking_variables.png)
<div class="center-em">
*Importance des variables*
</div>

Comme vous pouvez le voir, les variables qui apportent le plus d'information au mod√®le sont: 
- elo_ratio: le ratio des scores Elo des deux √©quipes 
- home_team: √©quipe √† domicile encod√©e (moyenne de matchs gagn√©s)
- away_team: √©quipe √† l'ext√©rieure encod√©e (moyenne de matchs gagn√©s)
- diff_mean_score_vs: la diff√©rence de score moyenne lors des derni√®res confrontations
- elo_score_home: score Elo de l'√©quipe √† domicile 
- elo_score_away: score Elo de l'√©quipe ext√®rieure 

En entrainant le random forest sur ces variables, j'obtiens une accuracy de **78%**. 
En cr√©ant de nouvelles variables (= gain d'information), nous arrivons petit √† petit 
√† r√©duire l'incertitude.

![Evaluation du random forest](../images/rugby_games_prediction/accuracy.png)
<div class="center-em">
*Rapport d'√©valuation du mod√®le*
</div>

Le mod√®le est moins bon pour pr√©dire la d√©faite de l'√©quipe √† domicile: 
celui-ci r√©ussi a bien cat√©goriser seulement 20% des matchs perdus 
par celle-ci (recall ci-dessus).

# 5. Les limites de l'analyse

Et voila, c'est termin√© les pronostics au doigt mouill√© ! Cette analyse qui s'appuie 
sur les donn√©es et du machine learning nous permet d'avoir une vision plus objective de l'issu d'un match. 
Cependant, il ne faut pas oublier que cette m√©thode est imparfaite et qu'elle ne prend 
pas en compte de nombreux param√®tres: m√©t√©o, composition des √©quipes. Au final, 
ces pronostics donnent des pistes, mais le rugby garde toute sa magie gr√¢ce √† l‚Äôimpr√©visible, et c'est pourquoi
on aime ce sport !

Voici mon pronostic pour la Journ√©e 13 entre le Stade Montois et Grenoble: 
![Pronostics J13](../images/rugby_games_prediction/pronostics.png)
<div class="center-em">
*Pronostics PRO D2 Stade Montois - Grenoble*
</div>

Je partage ces pronostics avant chaque journ√©e de TOP 14 et PRO D2 sur mon compte twitter [ici](https://x.com/DataRuck) üëà ou sur
ma page instagram [ici](https://www.instagram.com/data_ruck/) üëà. 
Si vous avez aim√© l'article, n'h√©sitez pas √† me follow ! 

## Annexes

### Score ELO
Pour chaque √©quipe, le score se calcule en deux temps:
1. Calcul de la probabilit√© de gagner:
$$
\begin{aligned}
P_{teamA}=\frac{1}{1+10^\frac{Elo_{teamB}-Elo_{teamA}}{400}}\\
\end{aligned}
$$

2. Mise √† jour du rating en fonction du r√©sultat du match 
$$
\begin{aligned}
NewElo{teamA} = OldElo_{teamA} + K \times (GameOutcome-P_{teamA})
\end{aligned}
$$
Avec $$GameOutcome=1$$ si team A gagne, $$GameOutcome=0.5$$ si √©galit√© et $$GameOutcome=0$$ si elle perd. 



